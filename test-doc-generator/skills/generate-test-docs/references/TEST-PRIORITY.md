# 测试优先级与风险评估

本文档定义测试用例优先级分类、判断规则和回归测试策略。

---

## 优先级定义

| 级别 | 名称 | 定义 | 发现缺陷影响 | 执行时机 |
|------|------|------|-------------|---------|
| **P0** | 阻塞级 | 核心功能，不可用则系统无法使用 | 阻塞发布 | 冒烟测试 |
| **P1** | 严重级 | 主要功能，影响核心业务流程 | 必须修复后发布 | 每日回归 |
| **P2** | 一般级 | 次要功能，不影响主流程 | 可带缺陷发布 | 全量回归 |
| **P3** | 轻微级 | 体验优化，边缘场景 | 低优先修复 | 有空执行 |

---

## 优先级判断规则

### 基于测试设计方法的默认优先级

| 用例来源 | 默认优先级 | 说明 |
|---------|-----------|------|
| 基本流（场景法） | P0 | 核心路径必须通过 |
| 有效等价类（核心输入） | P0/P1 | 正常输入必须处理 |
| 边界值（上下边界） | P1 | 边界易出错 |
| 备选流（场景法） | P1 | 替代路径需验证 |
| 无效等价类 | P1/P2 | 异常输入需处理 |
| 异常流（场景法） | P2 | 错误处理验证 |
| 错误推测（常见） | P2 | 经验性补充 |
| 错误推测（边缘） | P3 | 极端场景 |

### 优先级提升条件

以下条件出现时，优先级自动提升一级：

| 条件 | 说明 | 示例 |
|------|------|------|
| **涉及金额** | 支付、退款、结算相关 | 订单金额计算 |
| **涉及安全** | 认证、授权、敏感数据 | 密码验证、权限控制 |
| **高频功能** | 用户日常高频使用 | 登录、搜索、下单 |
| **历史缺陷** | 该模块曾多次出问题 | 根据记忆库判断 |
| **外部依赖** | 涉及第三方接口 | 支付网关、短信服务 |

### 优先级降低条件

以下条件出现时，优先级可降低一级：

| 条件 | 说明 | 示例 |
|------|------|------|
| **低频功能** | 用户很少使用 | 高级设置、导出功能 |
| **有降级方案** | 失败后有备用方案 | 推荐算法失效用默认列表 |
| **仅体验影响** | 不影响功能，仅影响体验 | 动画效果、排版微调 |

---

## 风险等级评估

### 模块风险评估矩阵

| 影响程度 \ 发生概率 | 高概率 | 中概率 | 低概率 |
|-------------------|--------|--------|--------|
| **高影响** | 极高风险 🔴 | 高风险 🟠 | 中风险 🟡 |
| **中影响** | 高风险 🟠 | 中风险 🟡 | 低风险 🟢 |
| **低影响** | 中风险 🟡 | 低风险 🟢 | 低风险 🟢 |

### 风险因素

**影响程度判断**：
- 高影响：影响核心业务、涉及资金、影响用户大于50%
- 中影响：影响主要功能、用户可感知、影响用户10-50%
- 低影响：影响次要功能、用户不易感知、影响用户<10%

**发生概率判断**：
- 高概率：新功能、复杂逻辑、历史多次出问题
- 中概率：一般功能、中等复杂度
- 低概率：成熟功能、简单逻辑、长期稳定

### 风险到优先级映射

| 风险等级 | 用例优先级分布 | 覆盖深度要求 |
|---------|---------------|-------------|
| 极高风险 | P0 40% + P1 40% + P2 20% | ≥8 用例/需求 |
| 高风险 | P0 30% + P1 40% + P2 30% | ≥5 用例/需求 |
| 中风险 | P0 20% + P1 40% + P2 40% | ≥3 用例/需求 |
| 低风险 | P0 10% + P1 30% + P2 60% | ≥2 用例/需求 |

---

## 回归测试分类

### 测试集定义

| 测试集 | 包含用例 | 执行频率 | 预期耗时 |
|--------|---------|---------|---------|
| **冒烟测试集** | 所有 P0 用例 | 每次构建 | <30分钟 |
| **核心回归集** | P0 + P1 用例 | 每日/每次提测 | 2-4小时 |
| **全量回归集** | 所有用例 | 发版前 | 1-2天 |

### 回归类型标记

在用例中标记回归类型：

| 回归类型 | 标记 | 说明 |
|---------|------|------|
| 冒烟 | `SMOKE` | 必须每次执行 |
| 核心 | `CORE` | 日常回归执行 |
| 全量 | `FULL` | 发版前执行 |

### 回归用例选择策略

**冒烟测试选择**：
- 每个核心模块的基本流
- 登录、核心业务主流程
- 数量控制：20-30条

**核心回归选择**：
- 所有冒烟用例
- 主要功能的正向+负向用例
- 上次迭代修复的缺陷回归
- 数量控制：100-200条

---

## Excel 输出字段

### 新增列定义

| 列名 | 数据类型 | 可选值 | 说明 |
|------|---------|--------|------|
| 优先级 | 下拉 | P0, P1, P2, P3 | 用例执行优先级 |
| 回归类型 | 下拉 | 冒烟, 核心, 全量 | 所属回归测试集 |
| 风险等级 | 下拉 | 高, 中, 低 | 关联功能风险 |
| 关联需求ID | 文本 | REQ_XXX | 追溯需求 |
| 设计方法 | 文本 | EP, BVA, ST, EG | 用例设计方法 |

### 优先级与回归类型对应

| 优先级 | 默认回归类型 |
|--------|-------------|
| P0 | 冒烟 |
| P1 | 核心 |
| P2 | 全量 |
| P3 | 全量 |

---

## 优先级分布参考

### 健康的用例优先级分布

| 优先级 | 占比 | 说明 |
|--------|------|------|
| P0 | 10-15% | 核心路径，不宜过多 |
| P1 | 30-40% | 主要功能覆盖 |
| P2 | 35-45% | 次要功能和异常处理 |
| P3 | 10-15% | 边缘场景 |

### 失衡信号

- P0 占比 >25%：过度标记，需重新评估
- P0 占比 <5%：可能遗漏关键场景
- P3 占比 >30%：可能过度测试边缘场景

---

## 自动判断逻辑

Claude 生成用例时，按以下逻辑自动判断优先级：

```
1. 识别用例类型（基本流/备选流/异常流/等价类/边界值/错误推测）
2. 获取默认优先级
3. 检查提升条件
   - if 涉及金额/安全 → 优先级 +1
   - if 高频功能 → 优先级 +1
   - if 历史缺陷模块 → 优先级 +1
4. 检查降低条件
   - if 低频功能 → 优先级 -1
   - if 仅体验影响 → 优先级 -1
5. 边界处理
   - 最高 P0，最低 P3
6. 根据优先级设置回归类型
```

---

## 执行策略建议

### 时间充裕

执行全量回归 + 探索性测试

### 时间紧张

1. 必须执行：冒烟测试（P0）
2. 应该执行：核心回归（P0 + P1）
3. 尽量执行：本次修改相关的 P2 用例

### 紧急发布

1. 执行冒烟测试
2. 本次修改功能的 P0 + P1 用例
3. 记录未执行用例，后续补测
