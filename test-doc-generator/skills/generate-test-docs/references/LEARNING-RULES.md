# 学习规则

定义 Skill 如何学习和改进的规则。

## 模板学习

### 触发条件
- 用户提供新模板文件
- 模板文件内容变化（通过 mtime 检测）

### 学习内容

**1. Excel 模板**
- 列名和顺序
- 列宽设置
- ID 格式模式
- 示例数据风格

**2. Markdown 模板**
- 标题层级结构
- 章节顺序
- 占位符格式（`{{}}`、`[]`、`TBD`）
- 表格列定义

### 学习流程
```
检测模板文件
    ↓
解析结构
    ↓
存入 template-schemas.json
    ↓
下次生成时使用学习到的结构
```

### 模板解析细节

**Excel 模板解析**：
1. 读取第一行作为列名
2. 记录每列宽度
3. 如有示例行，分析 ID 格式
4. 识别字段映射关系

**Markdown 模板解析**：
1. 提取所有标题及层级
2. 记录章节顺序
3. 识别占位符模式
4. 提取表格结构

## 术语学习

### 触发条件
- 解析需求文档时发现专业术语
- 用户在对话中解释术语
- 用户修正术语使用

### 学习内容

**1. 领域术语**
- 专业名词及其含义
- 缩写的全称

**2. 模块缩写**
- 模块名称 → 缩写映射
- 用于生成用例编号

### 识别模式
- 括号解释：`GMV（商品交易总额）`
- 冒号解释：`SKU：库存单位`
- 首字母缩写：检测大写字母组合
- 引号定义：`"SKU" 指库存单位`

### 术语提取示例

**输入文本**：
> 用户可以查看订单的 GMV（商品交易总额），系统需要按 SKU 维度统计。

**提取结果**：
```json
{
  "GMV": "商品交易总额",
  "SKU": "库存单位"
}
```

## 用户反馈学习

### 反馈类型

1. **纠正错误**：用户指出生成错误
2. **风格偏好**：用户表达格式偏好
3. **补充信息**：用户补充遗漏内容

### 学习流程
```
用户修改生成内容
    ↓
询问是否记住这个偏好？
    ↓
是 → 更新对应记忆文件
否 → 仅本次应用
```

### 可学习的偏好

| 类型 | 示例 | 存储位置 |
|------|------|---------|
| 用例编号格式 | `TC-LOGIN-001` | naming-conventions |
| 步骤编号风格 | 使用 a. b. c. | naming-conventions |
| 模块缩写 | 登录 → LGN | terminology |
| 预期结果风格 | 每条独立一行 | naming-conventions |

## 持续改进

### 生成质量提升

1. **分析历史生成记录**
   - 统计常见模块
   - 识别重复模式

2. **识别常见模式**
   - 同类需求的共性场景
   - 常见边界值处理

3. **优化场景覆盖**
   - 确保正向/反向/边界覆盖
   - 减少遗漏场景

### 效率提升

1. **缓存常用术语**
   - 预加载 terminology.json
   - 快速识别专业词汇

2. **复用模块结构**
   - 相似模块共享测试模式
   - 减少重复设计

3. **预测用户需求**
   - 基于历史推荐文档类型
   - 自动填充常用参数

## 记忆管理命令

| 命令 | 操作 | 说明 |
|------|------|------|
| "更新术语表" | 重新扫描 terminology.json | 手动触发术语更新 |
| "重新学习模板" | 重新解析模板结构 | 模板变化后使用 |
| "清除记忆" | 删除 .memory 文件夹 | 重置所有学习数据 |
| "显示学习记录" | 展示 generation-history | 查看历史生成 |
